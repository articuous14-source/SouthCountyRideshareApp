<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | South County Ride Share</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        .dashboard-page {
            min-height: 100vh;
            background: var(--light-bg);
            overflow-y: auto;
        }
        
        html, body {
            overflow-y: auto;
            height: auto;
        }
        
        .dashboard-header {
            background: var(--off-white);
            color: var(--primary-color);
            padding: 1.5rem 20px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .dashboard-header > .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dashboard-header h1 {
            font-size: 1.8rem;
            margin: 0;
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .admin-name {
            font-weight: 600;
        }
        
        .logout-btn {
            padding: 0.5rem 1.5rem;
            background: var(--white);
            color: var(--primary-color);
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
        }
        
        .dashboard-content {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 20px;
        }
        
        .view-toggle {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .view-group {
            background: var(--white);
            padding: 1rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }
        
        .view-group-title {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }
        
        .view-group-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .view-btn {
            flex: 1;
            min-width: 120px;
            padding: 0.75rem;
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .view-btn.active {
            background: var(--primary-color);
            color: var(--white);
        }
        
        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent-color);
        }
        
        .stat-card h3 {
            color: var(--primary-color);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-color);
        }
        
        .stat-card .stat-label {
            color: #666;
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }
        
        .drivers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .driver-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }
        
        .driver-card h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .driver-info-item {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .driver-info-item strong {
            color: var(--primary-color);
        }
        
        .income-chart {
            background: var(--white);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }
        
        .income-chart h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }
        
        .income-period {
            margin-bottom: 2rem;
        }
        
        .income-period h3 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }
        
        .income-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .income-item {
            padding: 1rem;
            background: var(--light-bg);
            border-radius: 5px;
        }
        
        .income-item-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.25rem;
        }
        
        .income-item-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color);
        }
        
        /* Reuse driver dashboard styles */
        .rides-container {
            display: grid;
            gap: 1.5rem;
        }
        
        .ride-card {
            background: var(--white);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .ride-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .ride-card.pending {
            border-left: 4px solid #ffc107;
        }
        
        .ride-card.accepted {
            border-left: 4px solid #28a745;
        }
        
        .ride-card.completed {
            border-left: 4px solid #28a745;
        }
        
        .ride-card.cancelled {
            border-left: 4px solid #dc3545;
        }
        
        .ride-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }
        
        .ride-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .ride-status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .ride-status.accepted {
            background: #d4edda;
            color: #155724;
        }
        
        .ride-status.completed {
            background: #d4edda;
            color: #155724;
        }
        
        .ride-status.cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        .ride-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.25rem;
        }
        
        .detail-value {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .accept-btn {
            padding: 0.75rem 2rem;
            background: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .accept-btn:hover {
            background: var(--secondary-color);
        }
        
        .accept-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .give-up-btn {
            padding: 0.5rem 1rem;
            background: #dc3545;
            color: var(--white);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        .give-up-btn:hover {
            background: #c82333;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .calendar-day {
            background: var(--white);
            border-radius: 10px;
            padding: 1rem;
            box-shadow: var(--shadow);
        }
        
        .calendar-day-header {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-bg);
        }
        
        .day-rides {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .day-ride-item {
            padding: 0.75rem;
            background: var(--light-bg);
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .empty-state h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .days-off-container, .notifications-container {
            /* Inherited from driver dashboard styles */
        }
        
        .conversation-item:hover {
            transform: translateX(3px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .calendar-view, .list-view {
            display: none;
        }
        
        .calendar-view.active, .list-view.active {
            display: block;
        }
        
        .notification-badge {
            background: var(--error-color);
            color: var(--white);
            border-radius: 10px;
            padding: 0.2rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .notifications-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .notification-item {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent-color);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .notification-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-hover);
        }
        
        .notification-item.unread {
            background: #f0f8ff;
            border-left-color: var(--primary-color);
        }
        
        .notification-item.read {
            opacity: 0.7;
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin: 0;
        }
        
        .notification-time {
            color: #999;
            font-size: 0.85rem;
            white-space: nowrap;
            margin-left: 1rem;
        }
        
        .notification-body {
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="dashboard-page">
        <div class="dashboard-header">
            <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1.5rem;">
                    <a href="index.html" style="display: flex; align-items: center;">
                        <img src="assets/SC_Rideshare_Final_Logo.jpg" alt="South County Ride Share Logo" style="height: 50px; width: auto;">
                    </a>
                    <h1 style="margin: 0; font-size: 1.8rem;">Admin Dashboard</h1>
                </div>
                <div class="admin-info">
                    <span class="admin-name" id="adminName">Loading...</span>
                    <button class="view-btn" onclick="openAdminSettings()" style="padding: 0.5rem 1rem; margin-right: 1rem; font-size: 0.9rem;">‚öôÔ∏è Settings</button>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
        
        <div class="dashboard-content">
            <!-- Confirmation Alert Banner -->
            <div id="confirmationAlert" style="display: none; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3); border-left: 5px solid #fff;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <div style="flex: 1; min-width: 300px;">
                        <h3 style="margin: 0 0 0.5rem 0; font-size: 1.3rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.5rem;">‚ö†Ô∏è</span>
                            <span>Rides Need Confirmation</span>
                        </h3>
                        <p style="margin: 0; font-size: 1rem; opacity: 0.95;" id="confirmationAlertText"></p>
                    </div>
                    <button onclick="viewUnconfirmedRidesAdmin()" style="background: white; color: #ff6b6b; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: transform 0.2s ease; white-space: nowrap;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        View Rides
                    </button>
                </div>
            </div>
            
            <!-- Stats Overview -->
            <div class="stats-grid" id="statsGrid">
                <!-- Stats will be loaded here -->
            </div>
            
            <div class="view-toggle">
                <!-- Main Navigation -->
                <div class="view-group">
                    <div class="view-group-title">Main</div>
                    <div class="view-group-buttons">
                        <button class="view-btn active" onclick="switchView('overview')" id="btn-overview">Overview</button>
                        <button class="view-btn" onclick="switchView('rides')" id="btn-rides">All Rides</button>
                        <button class="view-btn" onclick="switchView('calendar')" id="btn-calendar">Calendar</button>
                        <button class="view-btn" onclick="switchView('drivers')" id="btn-drivers">Drivers</button>
                    </div>
                </div>
                
                <!-- Financial -->
                <div class="view-group">
                    <div class="view-group-title">Financial</div>
                    <div class="view-group-buttons">
                        <button class="view-btn" onclick="switchView('income')" id="btn-income">Income</button>
                        <button class="view-btn" onclick="switchView('pricing')" id="btn-pricing">Pricing</button>
                    </div>
                </div>
                
                <!-- Management -->
                <div class="view-group">
                    <div class="view-group-title">Management</div>
                    <div class="view-group-buttons">
                        <button class="view-btn" onclick="switchView('reviews')" id="btn-reviews">
                            Reviews
                            <span id="reviewsBadge" class="notification-badge" style="display: none;">0</span>
                        </button>
                        <button class="view-btn" onclick="switchView('surveys')" id="btn-surveys">Surveys</button>
                        <button class="view-btn" onclick="switchView('announcements')" id="btn-announcements">Announcements</button>
                        <button class="view-btn" onclick="switchView('invites')" id="btn-invites">Invite Drivers</button>
                        <button class="view-btn" onclick="switchView('days-off')" id="btn-days-off">Days Off</button>
                        <button class="view-btn" onclick="switchView('archive')" id="btn-archive">Archive</button>
                    </div>
                </div>
                
                <!-- Notifications -->
                <div class="view-group">
                    <div class="view-group-title">Notifications</div>
                    <div class="view-group-buttons">
                        <button class="view-btn" onclick="switchView('notifications')" id="btn-notifications">
                            Notifications
                            <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
                        </button>
                    </div>
                </div>
                
                <!-- Messages -->
                <div class="view-group">
                    <div class="view-group-title">Messages</div>
                    <div class="view-group-buttons">
                        <button class="view-btn" onclick="switchView('messages')" id="btn-messages">
                            Messages
                            <span id="messagesBadge" class="notification-badge" style="display: none;">0</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Overview View -->
            <div id="overviewView" class="list-view active">
                <div class="income-chart">
                    <h2>Quick Income Summary</h2>
                    <div id="quickIncomeSummary">
                        <!-- Quick income summary will be loaded here -->
                    </div>
                </div>
                <div>
                    <h2 style="color: var(--primary-color); margin-bottom: 1rem;">Recent Activity</h2>
                    <div id="recentActivity">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Rides View -->
            <div id="ridesView" class="list-view">
                <div id="ridesList" class="rides-container">
                    <!-- All rides will be loaded here -->
                </div>
            </div>
            
            <!-- Calendar View -->
            <div id="calendarView" class="calendar-view">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                    <h2 style="color: var(--primary-color); margin: 0;">Calendar View</h2>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <label for="calendarMonthFilter" style="font-weight: 600; color: var(--primary-color); white-space: nowrap;">Month:</label>
                        <select id="calendarMonthFilter" style="padding: 0.75rem 1rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem; cursor: pointer; background: var(--white); color: var(--primary-color); font-weight: 600;" onchange="loadRides()">
                            <option value="all">All Months</option>
                        </select>
                    </div>
                </div>
                <div id="calendarGrid" class="calendar-grid">
                    <!-- Calendar will be loaded here -->
                </div>
            </div>
            
            <!-- Unconfirmed Rides View (Grouped by Driver) -->
            <div id="unconfirmedRidesView" class="list-view" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="color: var(--primary-color); margin: 0;">Rides Needing Confirmation</h2>
                    <button onclick="switchView('rides')" style="background: var(--primary-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; font-weight: 600; cursor: pointer; font-size: 1rem;">
                        Back to All Rides
                    </button>
                </div>
                <div id="unconfirmedRidesList">
                    <!-- Unconfirmed rides grouped by driver will be loaded here -->
                </div>
            </div>
            
            <!-- Drivers View -->
            <div id="driversView" class="list-view">
                <h2 style="color: var(--primary-color); margin-bottom: 1.5rem;">All Drivers</h2>
                <div id="driversList" class="drivers-grid">
                    <!-- Drivers will be loaded here -->
                </div>
            </div>
            
            <!-- Income View -->
            <div id="incomeView" class="list-view">
                <div class="income-chart">
                    <h2>Income Analytics</h2>
                    <div id="incomeAnalytics">
                        <!-- Income analytics will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Days Off View -->
            <div id="daysOffView" class="calendar-view">
                <div class="days-off-container">
                    <div class="days-off-section">
                        <h2 style="color: var(--primary-color); margin-bottom: 1.5rem;">Admin Days Off</h2>
                        <div class="add-day-off" style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <input type="date" id="adminDayOffDate" style="padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; margin-right: 1rem; flex: 1;">
                            <button class="accept-btn" onclick="addAdminDayOff()" style="padding: 0.75rem 2rem;">Add Day Off</button>
                        </div>
                        <div id="adminDaysOffList" class="days-off-list" style="margin-top: 2rem;">
                            <!-- Admin days off will be loaded here -->
                        </div>
                    </div>
                    <div class="days-off-section">
                        <h2 style="color: var(--primary-color); margin-bottom: 1.5rem;">All Drivers' Days Off</h2>
                        <div id="allDriversDaysOff" class="days-off-list">
                            <!-- All drivers days off will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Archive View -->
            <div id="archiveView" class="list-view">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="color: var(--primary-color); margin: 0;">Customer Archive</h2>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <input type="text" id="customerSearch" placeholder="Search customers..." style="padding: 0.75rem 1rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem; width: 300px;" oninput="filterCustomers()">
                        <button onclick="importRidesToArchive()" style="background: #28a745; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; font-weight: 600; cursor: pointer; font-size: 1rem;">
                            Import Existing Rides
                        </button>
                        <button onclick="exportCustomers()" style="background: var(--primary-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; font-weight: 600; cursor: pointer; font-size: 1rem;">
                            Export CSV
                        </button>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <button class="view-btn" onclick="switchCustomerFilter('active')" id="btn-active-customers" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">Active Customers</button>
                    <button class="view-btn" onclick="switchCustomerFilter('blocked')" id="btn-blocked-customers" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">Blocked Customers</button>
                </div>
                <div id="archiveContent">
                    <!-- Customer archive content will be loaded here -->
                </div>
            </div>
            
            <!-- Customer Details Modal -->
            <div id="customerDetailsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; overflow-y: auto;" onclick="if(event.target === this) closeCustomerDetailsModal();">
                <div style="background: white; margin: 2rem auto; max-width: 800px; border-radius: 10px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.3);" onclick="event.stopPropagation();">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e0e0e0;">
                        <h2 style="color: var(--primary-color); margin: 0;">Customer Details</h2>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="if(typeof createRideForCustomer === 'function') { createRideForCustomer(); } else { alert('Function not loaded. Please refresh the page.'); console.error('createRideForCustomer not found'); }" style="background: var(--primary-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 0.9rem;">+ Create Ride</button>
                            <button onclick="closeCustomerDetailsModal()" style="background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: 600;">‚úï Close</button>
                        </div>
                    </div>
                    <div id="customerDetailsContent">
                        <!-- Customer details will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Create Ride Modal -->
            <div id="createRideModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10001; overflow-y: auto;" onclick="if(event.target === this) closeCreateRideModal();">
                <div style="background: white; margin: 2rem auto; max-width: 900px; border-radius: 10px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.3); max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation();">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e0e0e0;">
                        <h2 style="color: var(--primary-color); margin: 0;">Create New Ride</h2>
                        <button onclick="closeCreateRideModal()" style="background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: 600;">‚úï Close</button>
                    </div>
                    <form id="createRideForm" onsubmit="submitCreateRide(event)">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label for="createRideName">Name <span style="color: #dc3545;">*</span></label>
                                <input type="text" id="createRideName" name="name" required>
                            </div>
                            <div class="form-group">
                                <label for="createRideEmail">Email <span style="color: #dc3545;">*</span></label>
                                <input type="email" id="createRideEmail" name="email" required>
                            </div>
                            <div class="form-group">
                                <label for="createRidePhone">Phone <span style="color: #dc3545;">*</span></label>
                                <input type="tel" id="createRidePhone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="createRidePassengers">Number of Passengers <span style="color: #dc3545;">*</span></label>
                                <input type="number" id="createRidePassengers" name="passengers" min="1" max="15" required>
                            </div>
                            <div class="form-group">
                                <label for="createRidePickup">Pickup Location <span style="color: #dc3545;">*</span></label>
                                <select id="createRidePickup" name="pickup" required onchange="handleCreateRideLocationChange('pickup')">
                                    <option value="">Select Pickup Location</option>
                                    <option value="Home">Home</option>
                                    <option value="John Wayne Airport (SNA)">John Wayne Airport (SNA)</option>
                                    <option value="Los Angeles Airport (LAX)">Los Angeles Airport (LAX)</option>
                                    <option value="Long Beach Airport (LGB)">Long Beach Airport (LGB)</option>
                                    <option value="San Diego Airport (SAN)">San Diego Airport (SAN)</option>
                                    <option value="Ontario Airport (ONT)">Ontario Airport (ONT)</option>
                                    <option value="Cross Border (CBX)">Cross Border (CBX)</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="createRideDestination">Destination <span style="color: #dc3545;">*</span></label>
                                <select id="createRideDestination" name="destination" required onchange="handleCreateRideLocationChange('destination')">
                                    <option value="">Select Destination</option>
                                    <option value="Home">Home</option>
                                    <option value="John Wayne Airport (SNA)">John Wayne Airport (SNA)</option>
                                    <option value="Los Angeles Airport (LAX)">Los Angeles Airport (LAX)</option>
                                    <option value="Long Beach Airport (LGB)">Long Beach Airport (LGB)</option>
                                    <option value="San Diego Airport (SAN)">San Diego Airport (SAN)</option>
                                    <option value="Ontario Airport (ONT)">Ontario Airport (ONT)</option>
                                    <option value="Cross Border (CBX)">Cross Border (CBX)</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="createRideVehicleType">Vehicle Type <span style="color: #dc3545;">*</span></label>
                                <select id="createRideVehicleType" name="vehicleType" required>
                                    <option value="">Select Vehicle Type</option>
                                    <option value="SEDAN">SEDAN</option>
                                    <option value="SUV">SUV</option>
                                    <option value="XL SUV">XL SUV</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="createRideDate">Date <span style="color: #dc3545;">*</span></label>
                                <input type="date" id="createRideDate" name="date" required>
                            </div>
                            <div class="form-group">
                                <label for="createRideTime">Time <span style="color: #dc3545;">*</span></label>
                                <input type="time" id="createRideTime" name="time" required>
                            </div>
                        </div>
                        
                        <!-- Home Address Fields (Pickup) -->
                        <div id="createRidePickupHomeAddress" style="display: none; background: #f8f9fa; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                            <h4 style="margin-bottom: 1rem; font-size: 1rem; color: #333;">Pickup Address</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label for="createRidePickupStreet">Street Address</label>
                                    <input type="text" id="createRidePickupStreet" name="pickupStreet">
                                </div>
                                <div class="form-group">
                                    <label for="createRidePickupCity">City</label>
                                    <input type="text" id="createRidePickupCity" name="pickupCity">
                                </div>
                                <div class="form-group">
                                    <label for="createRidePickupState">State</label>
                                    <input type="text" id="createRidePickupState" name="pickupState" maxlength="2" placeholder="CA">
                                </div>
                                <div class="form-group">
                                    <label for="createRidePickupZip">Zip Code</label>
                                    <input type="text" id="createRidePickupZip" name="pickupZip" maxlength="10">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Home Address Fields (Destination) -->
                        <div id="createRideDestinationHomeAddress" style="display: none; background: #f8f9fa; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                            <h4 style="margin-bottom: 1rem; font-size: 1rem; color: #333;">Destination Address</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label for="createRideDestinationStreet">Street Address</label>
                                    <input type="text" id="createRideDestinationStreet" name="destinationStreet">
                                </div>
                                <div class="form-group">
                                    <label for="createRideDestinationCity">City</label>
                                    <input type="text" id="createRideDestinationCity" name="destinationCity">
                                </div>
                                <div class="form-group">
                                    <label for="createRideDestinationState">State</label>
                                    <input type="text" id="createRideDestinationState" name="destinationState" maxlength="2" placeholder="CA">
                                </div>
                                <div class="form-group">
                                    <label for="createRideDestinationZip">Zip Code</label>
                                    <input type="text" id="createRideDestinationZip" name="destinationZip" maxlength="10">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Flight Info (if airport pickup) -->
                        <div id="createRideFlightInfo" style="display: none; background: #e3f2fd; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                            <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem; font-weight: 600;">
                                ‚úàÔ∏è Flight information required for airport pickups
                            </p>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label for="createRideFlightNumber">Flight Number <span style="color: #dc3545;">*</span></label>
                                    <input type="text" id="createRideFlightNumber" name="flightNumber" placeholder="e.g., AA1234">
                                </div>
                                <div class="form-group">
                                    <label for="createRideAirline">Airline <span style="color: #dc3545;">*</span></label>
                                    <input type="text" id="createRideAirline" name="airline" placeholder="e.g., American Airlines">
                                </div>
                            </div>
                            <div class="form-group" style="margin-top: 1rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="createRideBaggageClaim" name="baggageClaim" value="Y">
                                    <span>Driver will meet passenger inside of the baggage claim and escort them to parked vehicle.</span>
                                </label>
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid #e0e0e0;">
                            <button type="button" onclick="closeCreateRideModal()" style="background: #6c757d; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-weight: 600;">Cancel</button>
                            <button type="submit" style="background: var(--primary-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-weight: 600;">Create Ride</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Reviews View -->
            <div id="reviewsView" class="calendar-view">
                <div class="notifications-container">
                    <div class="notifications-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--primary-color); margin: 0;">Review Management</h2>
                        <div style="display: flex; gap: 1rem;">
                            <button class="view-btn" onclick="switchReviewFilter('pending')" id="btn-pending-reviews" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">Pending</button>
                            <button class="view-btn" onclick="switchReviewFilter('approved')" id="btn-approved-reviews" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">Approved</button>
                            <button class="view-btn" onclick="switchReviewFilter('all')" id="btn-all-reviews" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">All</button>
                        </div>
                    </div>
                    <div id="reviewsList" class="notifications-list">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Surveys View -->
            <div id="surveysView" class="calendar-view">
                <div class="notifications-container">
                    <div class="notifications-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <h2 style="color: var(--primary-color); margin: 0;">Customer Surveys</h2>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <label for="surveyStartDate" style="font-size: 0.9rem; color: #666;">From:</label>
                                <input type="date" id="surveyStartDate" style="padding: 0.5rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 0.9rem;">
                            </div>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <label for="surveyEndDate" style="font-size: 0.9rem; color: #666;">To:</label>
                                <input type="date" id="surveyEndDate" style="padding: 0.5rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 0.9rem;">
                            </div>
                            <select id="surveySort" style="padding: 0.5rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 0.9rem; cursor: pointer;">
                                <option value="newest">Newest First</option>
                                <option value="oldest">Oldest First</option>
                            </select>
                            <button class="view-btn" onclick="applySurveyFilters()" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">Apply Filters</button>
                            <button class="view-btn" onclick="clearSurveyFilters()" style="padding: 0.5rem 1.5rem; font-size: 0.9rem; background: #ccc;">Clear</button>
                        </div>
                    </div>
                    <div id="surveysList" class="notifications-list">
                        <!-- Surveys will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Pricing View -->
            <div id="pricingView" class="list-view">
                <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: var(--shadow);">
                    <h2 style="color: var(--primary-color); margin-bottom: 2rem;">Pricing Management</h2>
                    <div id="pricingContainer">
                        <!-- Pricing management interface will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Announcements View -->
            <div id="announcementsView" class="list-view">
                <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: var(--shadow);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--primary-color); margin: 0;">Announcements</h2>
                        <button class="accept-btn" onclick="openAnnouncementModal()" style="padding: 0.75rem 1.5rem;">Create New Announcement</button>
                    </div>
                    <div id="announcementsList">
                        <!-- Announcements will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Invite Drivers View -->
            <div id="invitesView" class="list-view">
                <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: var(--shadow);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--primary-color); margin: 0;">Invite Drivers</h2>
                        <button class="accept-btn" onclick="createNewInvite()" style="padding: 0.75rem 1.5rem;">Create Invite Link</button>
                    </div>
                    <div id="invitesList">
                        <!-- Invites will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Messages View -->
            <div id="messagesView" class="list-view">
                <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: var(--shadow);">
                    <h2 style="color: var(--primary-color); margin-bottom: 1.5rem;">Messages</h2>
                    <div style="display: grid; grid-template-columns: 300px 1fr; gap: 1.5rem; height: 600px;">
                        <!-- Conversations List -->
                        <div style="border-right: 2px solid var(--light-bg); padding-right: 1.5rem; overflow-y: auto;">
                            <h3 style="color: var(--primary-color); margin-bottom: 1rem; font-size: 1.1rem;">Conversations</h3>
                            <div id="conversationsList" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <!-- Conversations will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Chat Area -->
                        <div style="display: flex; flex-direction: column;">
                            <div id="chatHeader" style="padding-bottom: 1rem; border-bottom: 2px solid var(--light-bg); margin-bottom: 1rem;">
                                <h3 style="color: var(--primary-color); margin: 0;">Select a conversation</h3>
                            </div>
                            <div id="chatMessages" style="flex: 1; overflow-y: auto; margin-bottom: 1rem; padding: 1rem; background: var(--light-bg); border-radius: 5px;">
                                <!-- Messages will be displayed here -->
                            </div>
                            <div id="chatInputArea" style="display: none;">
                                <form id="messageForm" style="display: flex; gap: 0.5rem;">
                                    <input type="hidden" id="chatWithUsername">
                                    <input type="text" id="messageInput" placeholder="Type a message..." required style="flex: 1; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;">
                                    <button type="submit" style="padding: 0.75rem 1.5rem; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">Send</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notifications View -->
            <div id="notificationsView" class="calendar-view">
                <div class="notifications-container">
                    <div class="notifications-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--primary-color); margin: 0;">Admin Notifications</h2>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="view-btn" onclick="switchNotificationFilter('all')" id="btn-all-notifications" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">All</button>
                                <button class="view-btn" onclick="switchNotificationFilter('new_ride')" id="btn-new-ride-notifications" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">üöó New Rides</button>
                                <button class="view-btn" onclick="switchNotificationFilter('ride_accepted')" id="btn-accepted-notifications" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">‚úÖ Accepted</button>
                                <button class="view-btn" onclick="switchNotificationFilter('ride_rescheduled')" id="btn-rescheduled-notifications" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">üîÑ Rescheduled</button>
                                <button class="view-btn" onclick="switchNotificationFilter('ride_cancelled')" id="btn-cancelled-notifications" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">‚ùå Cancelled</button>
                                <button class="view-btn" onclick="switchNotificationFilter('ride_completed')" id="btn-completed-notifications" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">‚úì Completed</button>
                                <button class="view-btn" onclick="switchNotificationFilter('review_pending')" id="btn-review-notifications" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">‚≠ê Reviews</button>
                            </div>
                            <button class="accept-btn" onclick="markAllAdminNotificationsReadHandler()" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">Mark All as Read</button>
                        </div>
                    </div>
                    <div id="adminNotificationsList" class="notifications-list">
                        <!-- Admin notifications will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Driver Details Modal -->
    <div id="driverDetailsModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div class="modal" style="background: var(--white); border-radius: 10px; padding: 2rem; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: var(--primary-color); margin: 0;" id="driverModalTitle">Driver Details</h2>
                <button class="close-btn" style="background: none; border: none; font-size: 1.5rem; color: #999; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;" onclick="closeDriverDetailsModal()">&times;</button>
            </div>
            <div id="driverDetailsContent">
                <!-- Driver details will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Admin Reschedule Modal -->
    <div id="adminRescheduleModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div class="modal" style="background: var(--white); border-radius: 10px; padding: 2rem; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: var(--primary-color); margin: 0;">Reschedule Ride</h2>
                <button class="close-btn" style="background: none; border: none; font-size: 1.5rem; color: #999; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;" onclick="closeAdminRescheduleModal()">&times;</button>
            </div>
            <form id="adminRescheduleForm">
                <input type="hidden" id="adminRescheduleRideId">
                <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                    <label for="adminRescheduleDate" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">New Date</label>
                    <input type="date" id="adminRescheduleDate" required style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;">
                </div>
                <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                    <label for="adminRescheduleTime" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">New Time</label>
                    <input type="time" id="adminRescheduleTime" required style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;">
                </div>
                <div class="modal-actions" style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="button" class="modal-cancel-btn" style="flex: 1; padding: 0.75rem; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; background: #6c757d; color: var(--white);" onclick="closeAdminRescheduleModal()">Cancel</button>
                    <button type="submit" class="modal-submit-btn" style="flex: 1; padding: 0.75rem; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; background: var(--primary-color); color: var(--white);">Reschedule & Notify</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Admin Settings Modal -->
    <div id="adminSettingsModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div class="modal" style="background: var(--white); border-radius: 10px; padding: 2rem; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: var(--primary-color); margin: 0;">Admin Settings</h2>
                <button class="close-btn" style="background: none; border: none; font-size: 1.5rem; color: #999; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;" onclick="closeAdminSettings()">&times;</button>
            </div>
            <form id="adminSettingsForm">
                <div style="margin-bottom: 2rem; text-align: center;">
                    <div id="adminPhotoPlaceholder" style="width: 150px; height: 150px; border-radius: 50%; background: var(--light-bg); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; border: 3px solid var(--primary-color);">
                        <span style="font-size: 3rem;">üë§</span>
                    </div>
                    <img id="adminPhoto" src="" alt="Admin Photo" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; display: none; margin: 0 auto 1rem; border: 3px solid var(--primary-color);">
                    <div>
                        <label for="adminPhotoUpload" style="display: inline-block; padding: 0.5rem 1rem; background: var(--primary-color); color: var(--white); border-radius: 5px; cursor: pointer; font-size: 0.9rem;">
                            Upload Photo
                            <input type="file" id="adminPhotoUpload" accept="image/*" style="display: none;" onchange="handleAdminPhotoUpload(event)">
                        </label>
                    </div>
                </div>
                
                <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                    <label for="adminSettingsName" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">Full Name</label>
                    <input type="text" id="adminSettingsName" required style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;">
                </div>
                
                <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                    <label for="adminSettingsUsername" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">Username</label>
                    <input type="text" id="adminSettingsUsername" required style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;">
                </div>
                
                <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                    <label for="adminSettingsEmail" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">Email</label>
                    <input type="email" id="adminSettingsEmail" required style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;">
                </div>
                
                <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                    <label for="adminSettingsPhone" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">Phone Number</label>
                    <input type="tel" id="adminSettingsPhone" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;" placeholder="(555) 123-4567">
                </div>
                
                <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                    <label for="adminSettingsVehicle" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">Vehicle (Optional)</label>
                    <input type="text" id="adminSettingsVehicle" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;" placeholder="e.g., Sedan - White Toyota Camry">
                </div>
                
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="adminSettingsTimeFormat24" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="color: var(--primary-color); font-weight: 600;">Use Military Time (24-Hour Format)</span>
                    </label>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: #666;">Enable this to display times in 24-hour format throughout your dashboard</p>
                </div>
                
                <div style="border-top: 2px solid #e0e0e0; padding-top: 1.5rem; margin-top: 2rem; margin-bottom: 1.5rem;">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem; font-size: 1.1rem;">Change Password</h3>
                    <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                        <label for="adminSettingsCurrentPassword" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">Current Password</label>
                        <input type="password" id="adminSettingsCurrentPassword" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;" placeholder="Enter current password to change">
                    </div>
                    <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                        <label for="adminSettingsNewPassword" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">New Password</label>
                        <input type="password" id="adminSettingsNewPassword" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;" placeholder="Enter new password">
                    </div>
                    <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                        <label for="adminSettingsConfirmPassword" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">Confirm New Password</label>
                        <input type="password" id="adminSettingsConfirmPassword" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;" placeholder="Confirm new password">
                    </div>
                </div>
                
                <div id="adminSettingsMessage" class="form-message" style="margin-bottom: 1rem;"></div>
                
                <div class="modal-actions" style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="button" class="modal-cancel-btn" style="flex: 1; padding: 0.75rem; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; background: #6c757d; color: var(--white);" onclick="closeAdminSettings()">Cancel</button>
                    <button type="submit" class="modal-submit-btn" style="flex: 1; padding: 0.75rem; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; background: var(--primary-color); color: var(--white);">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Announcement Modal -->
    <div id="announcementModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div class="modal" style="background: var(--white); border-radius: 10px; padding: 2rem; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: var(--primary-color); margin: 0;" id="announcementModalTitle">New Announcement</h2>
                <button class="close-btn" style="background: none; border: none; font-size: 1.5rem; color: #999; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;" onclick="closeAnnouncementModal()">&times;</button>
            </div>
            <form id="announcementForm" onsubmit="handleAnnouncementSubmit(event)">
                <input type="hidden" id="announcementId">
                <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                    <label for="announcementTitle" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">Title</label>
                    <input type="text" id="announcementTitle" required style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem;" placeholder="Enter announcement title">
                </div>
                <div class="modal-form-group" style="margin-bottom: 1.5rem;">
                    <label for="announcementContent" style="display: block; margin-bottom: 0.5rem; color: var(--primary-color); font-weight: 600;">Content</label>
                    <textarea id="announcementContent" required rows="6" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem; font-family: inherit; resize: vertical;" placeholder="Enter announcement content"></textarea>
                </div>
                <div class="modal-actions" style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="button" class="modal-cancel-btn" style="flex: 1; padding: 0.75rem; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; background: #6c757d; color: var(--white);" onclick="closeAnnouncementModal()">Cancel</button>
                    <button type="submit" class="modal-submit-btn" style="flex: 1; padding: 0.75rem; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; background: var(--primary-color); color: var(--white);">Save Announcement</button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="api-client.js"></script>
    <script>
        // Verify API is loaded immediately and on page load
        function checkAPI() {
            if (typeof API === 'undefined') {
                console.error('API object not found. Checking window object...');
                console.log('Window.API:', window.API);
                console.log('All window properties:', Object.keys(window).filter(k => k.toLowerCase().includes('api')));
                return false;
            } else {
                console.log('API object loaded successfully:', Object.keys(API));
                if (API.surveys) {
                    console.log('Surveys API available:', typeof API.surveys.getAll);
                } else {
                    console.error('API.surveys is missing!');
                }
                return true;
            }
        }
        
        // Check immediately
        if (!checkAPI()) {
            // Check again after a short delay
            setTimeout(checkAPI, 100);
            // Check on page load
            window.addEventListener('load', checkAPI);
        }
    </script>
    <script src="driver-auth.js"></script>
    <script src="rates.js"></script>
    <script src="pricing-calculator.js"></script>
    <script src="admin-dashboard.js"></script>
</body>
</html>

